"use strict";const a=require("electron");a.contextBridge.exposeInMainWorld("ipcRenderer",l(a.ipcRenderer));a.contextBridge.exposeInMainWorld("electron",{saveModelFile:async(r,e)=>new Promise((o,t)=>{const s=new FileReader;s.onload=async i=>{try{if(!i.target||!i.target.result){t(new Error("Failed to read file"));return}const n=i.target.result,c=await a.ipcRenderer.invoke("save-model-file",n,e);o(c)}catch(n){t(n)}},s.onerror=i=>t(i),s.readAsArrayBuffer(r)}),saveImageFile:async(r,e)=>new Promise((o,t)=>{const s=new FileReader;s.onload=async i=>{try{if(!i.target||!i.target.result){t(new Error("Failed to read file"));return}const n=i.target.result,c=await a.ipcRenderer.invoke("save-image-file",n,e);o(c)}catch(n){t(n)}},s.onerror=i=>t(i),s.readAsArrayBuffer(r)}),testFileAccess:async r=>{try{let e=r;return e.startsWith("file://")?e=e.substring(7):e.startsWith("app-file://")&&(e=e.substring(11)),{success:!0,exists:await a.ipcRenderer.invoke("test-file-access",e)}}catch(e){return{success:!1,error:e.message}}},loadFileAsBlob:async r=>{try{let e=r;e.startsWith("file://")?e=e.substring(7):e.startsWith("app-file://")&&(e=e.substring(11));const o=await a.ipcRenderer.invoke("read-file-as-buffer",e),t=new Blob([o]);return{success:!0,blobUrl:URL.createObjectURL(t)}}catch(e){return{success:!1,error:e.message}}},loadImageFromAppFile:async r=>{try{if(r.startsWith("blob:"))return{success:!0,url:r};if(r.startsWith("app-file://")){const e=r.substring(11),o=await a.ipcRenderer.invoke("read-file-as-buffer",decodeURI(e)),t=e.split(".").pop().toLowerCase();let s="application/octet-stream";t==="jpg"||t==="jpeg"?s="image/jpeg":t==="png"?s="image/png":t==="gif"?s="image/gif":t==="webp"?s="image/webp":t==="svg"&&(s="image/svg+xml");const i=new Blob([o],{type:s}),n=URL.createObjectURL(i);return window._imageBlobCache=window._imageBlobCache||{},window._imageBlobCache[r]=n,{success:!0,url:n}}return{success:!0,url:r}}catch(e){return console.error("Error loading image from app-file:",e),{success:!1,error:e.message,url:r}}}});function l(r){const e=Object.getPrototypeOf(r);for(const[o,t]of Object.entries(e))Object.prototype.hasOwnProperty.call(r,o)||(typeof t=="function"?r[o]=function(...s){return t.call(r,...s)}:r[o]=t);return r}
